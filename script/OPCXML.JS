function OPCItem(b,c,a){this.mItemElement=c;this.mItemHandle=b;this.mAdditionalElements=a;this.mRefCount=1}function OPCItemValue(b,e,c,d,a){this.mItemPath=b;this.mItemName=e;this.mItemHandle=c;this.mItemValue=d;this.mItemResultId=a}function OPCItemProperties(h,j,l,e,d,c,a,g,f,b,k,i){this.mItemPath=h;this.mItemName=j;this.mName=l;this.mIsItem=e;this.mHasChildren=d;this.mResultId=c;this.mValue=a;this.mType=g;this.mAccessRights=f;this.mEffectiveness=k;this.mEnums=b;this.mIsEnum=i}function RequestHandler(b,c,a){this.mXMLHttpRequest=null;this.mSOAPAction=c;this.mCallBack=b;this.mTimeout=null;this.mState=0;this.sendRequest=function(g,j,f){var e=this;if(this.mState==0){this.mXMLHttpRequest=createHTTPRequest();if(this.mXMLHttpRequest){this.mXMLHttpRequest.onreadystatechange=function(){if(e.mXMLHttpRequest.readyState==4){e.mState=0;clearTimeout(e.mTimeout);e.mCallBack(e.mXMLHttpRequest.responseXML)}};var d=(j!=undefined)?j:true;if(f!=undefined){this.mXMLHttpRequest.open("POST",f+"/soap/opcxml",d)}else{this.mXMLHttpRequest.open("POST","/soap/opcxml",d)}this.mXMLHttpRequest.setRequestHeader("Accept","application/xml, text/xml, */*");this.mXMLHttpRequest.setRequestHeader("Content-Type","text/xml; charset=utf-8");this.mXMLHttpRequest.setRequestHeader("SOAPAction","http://opcfoundation.org/webservices/XMLDA/1.0/"+this.mSOAPAction);var h=function(){e.mState=0;e.mCallBack(null);if(e.mXMLHttpRequest){e.mXMLHttpRequest.abort()}};this.mState=1;this.mTimeout=setTimeout(h,20000);if(typeof XMLSerializer=="undefined"){this.mXMLHttpRequest.send(g)}else{var i=(new XMLSerializer()).serializeToString(g);i=i.replace(/xmlns:NS\d+=""\s+NS\d+:/ig,"");this.mXMLHttpRequest.send(i)}}}else{alert("Wrong status")}};this.destructor=function(){if(this.mXMLHttpRequest){this.mXMLHttpRequest.onreadystatechange=dummy;this.mXMLHttpRequest.abort()}this.mXMLHttpRequest=null}}function dummy(){}function OPCcreateItemHandle(a,b){return a+"@"+b}function OPCItemListManager(a,b){this.addItem=function(m,h,i,f,g,e){var d=f;if(!d){d=OPCcreateItemHandle(h,i)}if(!this.mItems[d]){var j=m.createElement(this.mItemTag);j.setAttribute("ItemPath",h);j.setAttribute("ItemName",i);j.setAttribute("ClientItemHandle",d);if(e){j.setAttribute("ReqType",e)}var c=m.getElementsByTagName(this.mListTag);c[0].appendChild(j);if(g){for(var l=0;l<g.length;l++){c[0].appendChild(g[l])}}var k=new OPCItem(d,j,g);this.mItems[d]=k;this.mItemCount++}else{this.mItems[d].mRefCount++}return this.mItems[d]};this.getItem=function(c){return this.mItems[c]};this.removeItem=function(h,e){if(this.mItems[e]){var d=this.mItems[e];d.mRefCount--;if(d.mRefCount<=0){delete this.mItems[e];this.mItemCount--;var c=h.getElementsByTagName(this.mListTag);c[0].removeChild(d.mItemElement);var g=d.mAdditionalElements;if(g){for(var f=0;f<g.length;f++){c[0].removeChild(d.mAdditionalElements[f])}}}}};this.createItemValueList=function(d,j){var k=new Array();var c;if(d){c=d.getElementsByTagName(j)}if(c){var s;for(s=0;s<c.length;s++){var n;var l;var f;var p;var o;var r=c[s];var i=r.attributes;var e=i.length;var q;for(q=0;q<e;q++){o=undefined;var h=i[q];var m=h.nodeName;if(m=="ItemName"){n=h.nodeValue}else{if(m=="ItemPath"){l=h.nodeValue}else{if(m=="ClientItemHandle"){f=h.nodeValue}else{if(m=="ResultID"){o=h.nodeValue}}}}}p="Error";var g=r.childNodes[0];if(g){p=(g.childNodes.length>0)?g.childNodes[0].nodeValue:""}k[s]=new OPCItemValue(l,n,f,p,o)}c=null}return k};this.mItems=new Array();this.mItemCount=0;this.mListTag=a;this.mItemTag=b}function OPCGetProperties(e){var n=e.getAttribute("ItemPath");var s=e.getAttribute("ItemName");var r=e.getAttribute("ResultID");var q=e.childNodes;var j=undefined;var b=undefined;var h=undefined;var g=false;var k=undefined;var p=undefined;var l=undefined;if(!r){for(l=0;l<q.length;l++){var i=q[l];var a=i.getAttribute("Name");switch(a){case"value":var o=i.childNodes[0];if(o){b=(o.childNodes.length>0)?o.childNodes[0].nodeValue:""}break;case"dataType":var o=i.childNodes[0];h=o.childNodes[0].nodeValue;break;case"accessRights":var o=i.childNodes[0];k=o.childNodes[0].nodeValue;break;case"effectiveness":var o=i.childNodes[0];p=o.childNodes[0].nodeValue;break;case"euInfo":var f=i.childNodes[0];var d=f.childNodes.length;j=new Array();for(var c=0;c<d;c++){j.push(f.childNodes[c].childNodes[0].nodeValue)}break;case"euType":var o=i.childNodes[0];g=(o.childNodes[0].nodeValue=="enumerated");break}}}var m=new OPCItemProperties(n,s,undefined,true,false,r,b,h,k,j,p,g);return m}function OPCGetPropertiesRequest(e,l,b,a,m,d){this.addItem=function(o,q){var n=new Array();var p=this.mItemListManager.addItem(this.mSOAPDocument,o,q,undefined,n);return p.mItemHandle};this.removeItem=function(n){this.mItemListManager.removeItem(n)};this.sendGetPropertiesRequest=function(n){if(this.mRequestHandler){if(n==undefined){n=true}this.mRequestHandler.sendRequest(this.mSOAPDocument,n,this.mRedirectPath)}};this.destructor=function(){this.mRequestHandler.destructor()};this.procResult=function(q){var p=new Array();if(q){var r=q.getElementsByTagName("PropertyLists");if(r&&(r.length>0)){for(var n=0;n<r.length;n++){var o=OPCGetProperties(r[n]);p.push(o)}}}if(this.mResultCB){if(this.mResultCB(p,this.mRequestHandle)){this.destructor()}}};this.mSOAPDocument=createSOAPDocument();this.mItemListManager=new OPCItemListManager("GetProperties","ItemIDs");this.mResultCB=l;this.mRedirectPath=(m!=undefined)?m:"";this.mRequestHandle=d;if(this.mSOAPDocument){var f=this.mSOAPDocument.getElementsByTagName("Soap:Body");if(f){var h=this.mSOAPDocument.createElement("GetProperties");h.setAttribute("LocaleId",e);if((b==undefined)||(b==null)||(b==true)){h.setAttribute("ReturnAllProperties","true")}h.setAttribute("ReturnErrorText","true");h.setAttribute("ReturnPropertyValues","true");h.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");if(a){for(var k=0;k<a.length;k++){var c=this.mSOAPDocument.createElement("PropertyNames");var j=this.mSOAPDocument.createTextNode(a[k]);c.appendChild(j);h.appendChild(c)}}f[0].appendChild(h)}else{this.mSOAPDocument=null}}var i=this;var g=function(n){i.procResult(n)};this.mRequestHandler=new RequestHandler(g,"GetProperties","GetPropertiesResponse")}function OPCStatusRequest(f,c){this.sendStatusRequest=function(){if(this.mRequestHandler){this.mRequestHandler.sendRequest(this.mSOAPDocument,true,"")}};this.destructor=function(){this.mRequestHandler.destructor()};this.procResult=function(g){var l=g;if(g){var k="";var i=g.getElementsByTagName("GetStatusResult");if(i){var p=i[0].attributes;if(p){var h=p.length;var o;for(o=0;o<h;o++){var j=p[o];k+=j.nodeName+": "+j.nodeValue+"\n"}}}var n=g.getElementsByTagName("StatusInfo");if(n){var m=n[0].childNodes[0].nodeValue;k+="\n"+m+"\n"}}if(this.mResultCB){if(this.mResultCB(g)){this.destructor()}}};this.mSOAPDocument=createSOAPDocument();if(this.mSOAPDocument){var b=this.mSOAPDocument.getElementsByTagName("Soap:Body");if(b){var d=this.mSOAPDocument.createElement("GetStatus");d.setAttribute("LocaleID",f);d.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");b[0].appendChild(d)}else{this.mSOAPDocument=null}}var a=this;var e=function(g){a.procResult(g)};this.mResultCB=c;this.mRequestHandler=new RequestHandler(e,"GetStatus","GetStatusResponse")}function OPCReadRequest(g,d){this.addItem=function(h,j){var i=this.mSOAPDocument.createElement("Items");i.setAttribute("ItemPath",h);i.setAttribute("ItemName",j);this.mItemList.appendChild(i)};this.sendReadRequest=function(){if(this.mRequestHandler){this.mRequestHandler.sendRequest(this.mSOAPDocument)}};this.destructor=function(){this.mRequestHandler.destructor()};this.procResult=function(i){var o=new Array();var h;if(i){h=i.getElementsByTagName("Items")}if(h){var w;for(w=0;w<h.length;w++){var r=undefined;var p=undefined;var s=undefined;var t=undefined;var v=h[w];var n=v.attributes;var j=n.length;var u;for(u=0;u<j;u++){var m=n[u];var q=m.nodeName;if(q=="ItemName"){r=m.nodeValue}else{if(q=="ItemPath"){p=m.nodeValue}else{if(q=="ResultID"){t=m.nodeValue}}}}var l=v.firstChild;s="";if(l&&l.hasChildNodes()){s=l.firstChild.nodeValue}var k=OPCcreateItemHandle(p,r);o[w]=new OPCItemValue(p,r,k,s,t)}}if(this.mResultCB){if(this.mResultCB(o)){this.destructor()}}};this.mSOAPDocument=createSOAPDocument();this.mItemList=null;this.mResultCB=d;if(this.mSOAPDocument){var c=this.mSOAPDocument.getElementsByTagName("Soap:Body");if(c){var e=this.mSOAPDocument.createElement("Read");e.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");var b=this.mSOAPDocument.createElement("Options");b.setAttribute("LocaleID",g);b.setAttribute("ReturnItemName","true");b.setAttribute("ReturnItemPath","true");this.mItemList=this.mSOAPDocument.createElement("ItemList");this.mItemList.setAttribute("ReqType","xsd:string");e.appendChild(b);e.appendChild(this.mItemList);c[0].appendChild(e)}else{this.mSOAPDocument=null}}var a=this;var f=function(h){a.procResult(h)};this.mRequestHandler=new RequestHandler(f,"Read","ReadResponse")}var gloOPCWriteRequestId=0;function OPCWriteRequest(g,e){this.addItem=function(i,n,m){var l=this.mItemListManager.addItem(this.mSOAPDocument,i,n);if(l.mRefCount==1){var j=m;if(!j){j="xsd::string"}var k=l.mItemElement;k.setAttribute("ValueTypeQualifier",j);var o=this.mSOAPDocument.createElement("Value");o.setAttribute("xsi:type",j);var h=this.mSOAPDocument.createTextNode("0");o.appendChild(h);k.appendChild(o)}return l.mItemHandle};this.removeItem=function(h){this.mItemListManager.removeItem(h)};this.setItemValue=function(j,h){var i=this.mItemListManager.getItem(j);if(i){i.mItemElement.childNodes[0].childNodes[0].nodeValue=h}};this.sendWriteRequest=function(){if(this.mRequestHandler){this.mRequestHandler.sendRequest(this.mSOAPDocument)}};this.destructor=function(){this.mRequestHandler.destructor()};this.mSOAPDocument=createSOAPDocument();this.mItemListManager=new OPCItemListManager("ItemList","Items");this.mItemList=null;this.mResultCB=e;this.procResult=function(i){var h=this.mItemListManager.createItemValueList(i,"Items");if(this.mResultCB){if(this.mResultCB(h)){this.destructor()}}};if(this.mSOAPDocument){var d=this.mSOAPDocument.getElementsByTagName("Soap:Body");if(d){var c=this.mSOAPDocument.createElement("Write");c.setAttribute("ReturnValuesOnReply","true");c.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");var b=this.mSOAPDocument.createElement("Options");b.setAttribute("LocaleID",g);b.setAttribute("ReturnItemName","true");b.setAttribute("ReturnItemPath","true");this.mItemList=this.mSOAPDocument.createElement("ItemList");c.appendChild(b);c.appendChild(this.mItemList);d[0].appendChild(c)}else{this.mSOAPDocument=null}}var a=this;var f=function(h){a.procResult(h)};this.mRequestHandler=new RequestHandler(f,"Write","WriteResponse");this.mName="OPCWriteRequest_"+gloOPCWriteRequestId++}function OPCBrowseRequest(e,m,a,l,f,n){this.sendBrowseRequest=function(o,p){switch(this.mState){case 0:this.mItemPath=o;this.mItemName=p;this.mBrowse.setAttribute("ItemPath",o);this.mBrowse.setAttribute("ItemName",p);this.mBrowse.setAttribute("ContinuationPoint","0");this.mIndex=0;this.mResult=new Array();if(this.mRedirectPath){this.mRequestHandler.sendRequest(this.mSOAPDocument,true,n)}else{this.mRequestHandler.sendRequest(this.mSOAPDocument)}break}};this.destructor=function(){this.mRequestHandler.destructor()};this.procResult=function(o){var x;if(o){x=o.getElementsByTagName("Elements");if(x){var y;for(y=0;y<x.length;y++,this.mIndex++){var E;var q;var v;var C;var w;var F=x[y];var s=F.attributes;var t=s.length;var u;for(u=0;u<t;u++){var z=s[u];var r=z.nodeName;if(r=="Name"){q=z.nodeValue}else{if(r=="ItemName"){E=z.nodeValue}else{if(r=="ItemPath"){v=z.nodeValue}else{if(r=="IsItem"){C=(z.nodeValue=="true")}else{if(r=="HasChildren"){w=(z.nodeValue=="true")}}}}}}var p=undefined;if(C){p=OPCGetProperties(F);p.mName=q;p.mIsItem=C;p.mHasChildren=w}else{p=new OPCItemProperties(v,E,q,C,w)}this.mResult[this.mIndex]=p}}var B=o.getElementsByTagName("BrowseResponse");if(B&&(B.length>0)){var A=0;var D=0;var s=B[0].attributes;var t=s.length;var u;for(u=0;u<t;u++){var z=s[u];var r=z.nodeName;if(r=="MoreElements"){A=(z.nodeValue=="true")}else{if(r=="ContinuationPoint"){D=z.nodeValue}}}if(A&&(D>0)){this.mBrowse.setAttribute("ContinuationPoint",D);if(this.mRedirectPath){this.mRequestHandler.sendRequest(this.mSOAPDocument,true,n)}else{this.mRequestHandler.sendRequest(this.mSOAPDocument)}}else{if(this.mResultCB){this.mResultCB(this.mResult,this.mItemPath,this.mItemName)}}}else{if(this.mResultCB){this.mResultCB(this.mResult,this.mItemPath,this.mItemName)}}}else{if(this.mResultCB){this.mResultCB(this.mResult,this.mItemPath,this.mItemName)}}this.mState=0};this.mItemPath="";this.mItemName="";this.mState=0;this.mResultCB=m;this.mIndex=0;this.mBrowse;this.mResult;this.mSOAPDocument=createSOAPDocument();if(this.mSOAPDocument){var g=this.mSOAPDocument.getElementsByTagName("Soap:Body");if(g){this.mBrowse=this.mSOAPDocument.createElement("Browse");this.mBrowse.setAttribute("LocaleID",e);this.mBrowse.setAttribute("MaxElementsReturned","30");var d=((l!=undefined)&&l);this.mBrowse.setAttribute("ReturnAllProperties",d);this.mBrowse.setAttribute("ReturnErrorText","false");var c=((f!=undefined)&&f);this.mBrowse.setAttribute("ReturnPropertyValues",c);this.mBrowse.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");g[0].appendChild(this.mBrowse);if(a){for(var k=0;k<a.length;k++){var b=this.mSOAPDocument.createElement("PropertyNames");var i=this.mSOAPDocument.createTextNode(a[k]);b.appendChild(i);this.mBrowse.appendChild(b)}}}}this.mRedirectPath=n;var j=this;var h=function(o){j.procResult(o)};this.mRequestHandler=new RequestHandler(h,"Browse","BrowseResponse")}function OPCSubscriptionRequest(c,l,f){this.refresh=function(m){if(this.mItemListManager.mItemCount>0){switch(this.mState){case 0:this.mState=1;this.sendSubscribeRequest();break;case 2:this.mState=3;this.sendSubscriptionPolledRefresh(m);break}}};this.addItem=function(n,p,o,m){return this.mItemListManager.addItem(this.mSubscribeSOAPDocument,n,p,o,undefined,m).mItemHandle};this.removeItem=function(m){this.mItemListManager.removeItem(this.mSubscribeSOAPDocument,m)};this.cancel=function(){switch(this.mState){case 0:this.procCancelResponse();break;case 1:this.mState=5;break;case 2:this.mState=4;this.sendSubscriptionCancel();break;case 3:this.mState=6}};this.destructor=function(){switch(this.mState){case 0:case 1:break;case 2:case 3:this.sendSubscriptionCancel(false);break}this.mState=255;this.mSubscribeRequestHandler.destructor();this.mSubscriptionPolledRefreshRequestHandler.destructor();this.mSubscriptionCancelRequestHandler.destructor()};this.procResult=function(m){if(m){switch(this.mState){case 0:if(this.mResultCB){this.mResultCB(undefined,t,undefined)}break;case 1:var t="OK";var s;var w=m.getElementsByTagName("SubscribeResult");if(w.length>0){s=w[0].getAttribute("ReplyTime");this.mReplyTime=s;w=null}if(t=="OK"){var y=m.getElementsByTagName("SubscribeResponse");if(y.length>0){var o=y[0].getAttribute("ServerSubHandle");if(o){var u=this.mPolledRefreshDocument.getElementsByTagName("ServerSubHandles");var p=this.mPolledRefreshDocument.createTextNode(o);var r=u[0].firstChild;if(r){u[0].replaceChild(p,r)}else{u[0].appendChild(p)}u=null;p=null;var v=this.mSubscriptionCancelDocument.getElementsByTagName("SubscriptionCancel");v[0].setAttribute("ServerSubHandle",o);v=null;o=null;y=null;this.mState=2}else{this.mState=0}var x=this.mItemListManager.createItemValueList(m,"ItemValue");if(this.mResultCB){this.mResultCB(x,t,s)}}}if(t!="OK"){this.mState=0;var x=this.mItemListManager.createItemValueList(m,"ItemValue");if(this.mResultCB){this.mResultCB(x,"OK",s)}}break;case 2:case 3:var t="OK";var s;var n=m.getElementsByTagName("InvalidServerSubHandles");if(n.length==0){var q=m.getElementsByTagName("SubscriptionPolledRefreshResult");if(q.length>0){s=q[0].getAttribute("ReplyTime");this.mReplyTime=s;q=null}else{t="INVALID_RESPONSE"}}else{t="INVALID_SERVER_SUBHANDLE"}if(t=="OK"){var x=this.mItemListManager.createItemValueList(m,"Items");this.mState=2;if(this.mResultCB){this.mResultCB(x,t,s)}}else{this.mState=0;if(this.mResultCB){this.mResultCB(undefined,t,s)}}break;case 5:var y=m.getElementsByTagName("SubscribeResponse");if(y.length>0){var o=y[0].getAttribute("ServerSubHandle");if(o){var v=this.mSubscriptionCancelDocument.getElementsByTagName("SubscriptionCancel");if(v){v[0].setAttribute("ServerSubHandle",o);v=null}o=null;y=null;this.mState=2;this.cancel()}else{this.mState=0;if(this.mCancelCB){this.mCancelCB()}}}else{this.mState=0}break;case 6:this.mState=2;this.cancel();break;default:alert(this.mState);break}}else{this.mState=0;if(this.mResultCB){this.mResultCB(undefined,"NO_RESPONSE",undefined)}}};this.procCancelResponse=function(){this.mState=0;if(this.mCancelCB){this.mCancelCB()}};this.sendSubscribeRequest=function(){if(this.mSubscribeRequestHandler){this.mSubscribeRequestHandler.sendRequest(this.mSubscribeSOAPDocument)}};this.sendSubscriptionPolledRefresh=function(m){if(this.mSubscriptionPolledRefreshRequestHandler){this.mPolledRefreshElement.setAttribute("HoldTime",this.mReplyTime);if(m==undefined){m=false}this.mPolledRefreshElement.setAttribute("ReturnAllItems",m);this.mSubscriptionPolledRefreshRequestHandler.sendRequest(this.mPolledRefreshDocument)}};this.sendSubscriptionCancel=function(n){if(this.mSubscriptionCancelRequestHandler){var m=(n==undefined)?true:n;this.mSubscriptionCancelRequestHandler.sendRequest(this.mSubscriptionCancelDocument,m)}};this.mSubscribeSOAPDocument=createSOAPDocument();this.mPolledRefreshDocument=createSOAPDocument();this.mPolledRefreshElement;this.mForceRefresh=false;this.mSubscriptionCancelDocument=createSOAPDocument();this.mResultCB=l;this.mCancelCB=f;this.mItemListManager=new OPCItemListManager("ItemList","Items");this.mReplyTime;this.mState=0;if(this.mSubscribeSOAPDocument){var g=this.mSubscribeSOAPDocument.getElementsByTagName("Soap:Body");if(g){var d=this.mSubscribeSOAPDocument.createElement("Subscribe");d.setAttribute("ReturnValuesOnReply","true");d.setAttribute("SubscriptionPingRate","0");d.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");var b=this.mSubscribeSOAPDocument.createElement("Options");b.setAttribute("LocaleID",c);b.setAttribute("ReturnDiagnosticInfo","false");b.setAttribute("ReturnErrorText","true");b.setAttribute("ReturnItemName","true");b.setAttribute("ReturnItemPath","true");b.setAttribute("ReturnItemTime","false");var a=this.mSubscribeSOAPDocument.createElement("ItemList");d.appendChild(b);d.appendChild(a);g[0].appendChild(d);b=null;d=null;g=null}}if(this.mPolledRefreshDocument){var g=this.mPolledRefreshDocument.getElementsByTagName("Soap:Body");if(g){this.mPolledRefreshElement=this.mPolledRefreshDocument.createElement("SubscriptionPolledRefresh");this.mPolledRefreshElement.setAttribute("HoldTime",this.mReplyTime);this.mPolledRefreshElement.setAttribute("ReturnAllItems","false");this.mPolledRefreshElement.setAttribute("WaitTime","1000");this.mPolledRefreshElement.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");var b=this.mPolledRefreshDocument.createElement("Options");b.setAttribute("LocaleID","de");b.setAttribute("ReturnDiagnosticInfo","false");b.setAttribute("ReturnErrorText","false");b.setAttribute("ReturnItemName","true");b.setAttribute("ReturnItemPath","true");b.setAttribute("ReturnItemTime","false");var k=this.mPolledRefreshDocument.createElement("ServerSubHandles");this.mPolledRefreshElement.appendChild(b);this.mPolledRefreshElement.appendChild(k);g[0].appendChild(this.mPolledRefreshElement);b=null;k=null;g=null}}if(this.mSubscriptionCancelDocument){var g=this.mSubscriptionCancelDocument.getElementsByTagName("Soap:Body");if(g){var i=this.mSubscriptionCancelDocument.createElement("SubscriptionCancel");i.setAttribute("xmlns","http://opcfoundation.org/webservices/XMLDA/1.0/");g[0].appendChild(i);i=null;g=null}}var j=this;var h=function(m){j.procResult(m)};this.mSubscribeRequestHandler=new RequestHandler(h,"Subscribe","SubscribeResponse");this.mSubscriptionPolledRefreshRequestHandler=new RequestHandler(h,"SubscriptionPolledRefresh","SubscriptionPolledRefreshResponse");var e=function(){j.procCancelResponse()};this.mSubscriptionCancelRequestHandler=new RequestHandler(e,"SubscriptionCancel","SubscriptionCancelResponse")}function OPCSubscriptionAutoRefresh(h,c,b,g,f){this.startRefresh=function(){switch(this.mState){case 0:case 5:this.mState=1;this.mSubscription.refresh();break}};this.restart=function(){switch(this.mState){case 0:this.startRefresh();break;case 2:clearTimeout(this.mTimer);case 1:this.mState=3;this.mSubscription.cancel();break;case 3:break}};this.cancel=function(){switch(this.mState){case 2:clearTimeout(this.mTimer);case 1:case 3:this.mState=4;this.mSubscription.cancel();break}};this.addItem=function(k,n,l,j,i){var m=this.mSubscription.addItem(k,n,l,i);if(!(j&&(j==true))){this.restart()}return m};this.removeItem=function(i){this.mSubscription.removeItem(i);this.restart()};this.destructor=function(){this.mState=255;this.mSubscription.destructor()};this.refresh=function(){switch(this.mState){case 2:this.mState=1;this.mSubscription.refresh(this.mReturnAllItems);break}};this.procResult=function(j,m,l){switch(this.mState){case 1:if(m=="OK"){this.mState=2;if(this.mResultCB){this.mResultCB(j,m,l)}var i=this;var k=function(){i.refresh()};this.mTimer=setTimeout(k,this.mCycleTime)}else{if(m=="INVALID_SERVER_SUBHANDLE"){this.mState=0;this.startRefresh()}else{}}break}};this.procCancelCB=function(){switch(this.mState){case 3:this.mState=0;this.startRefresh();break;case 4:this.mState=5;if(this.mCancelCB){this.mCancelCB()}}};var a=this;var e=function(i,k,j){a.procResult(i,k,j)};var d=function(){a.procCancelCB()};this.mSubscription=new OPCSubscriptionRequest(h,e,d);this.mState=0;this.mTimer;this.mCycleTime=g;this.mResultCB=c;this.mCancelCB=b;this.mReturnAllItems=f};